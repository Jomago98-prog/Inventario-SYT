<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>InventarioSYT</title>
</head>
<body>
  <h1>Formulario de Inventario</h1>
  <form id="formulario">
    <input type="text" id="nombre" placeholder="Nombre" required><br>
    <input type="text" id="codigoSAP" placeholder="Código SAP" required><br>
    <input type="text" id="reserva" placeholder="Reserva"><br>
    <input type="text" id="disciplina" placeholder="Disciplina"><br>
    <input type="text" id="descripcion" placeholder="Descripción"><br>
    <input type="number" id="cantidad" placeholder="Cantidad"><br>
    <input type="text" id="diametro" placeholder="Diámetro"><br>
    <input type="text" id="sch" placeholder="Sch"><br>
    <input type="text" id="longitud" placeholder="Longitud"><br>
    <input type="text" id="peso" placeholder="Peso (Kg)"><br>
    <input type="text" id="fabricante" placeholder="Fabricante"><br>
    <input type="text" id="serial" placeholder="Serial"><br>
    <input type="text" id="modelo" placeholder="Modelo"><br>
    <input type="text" id="escala" placeholder="Escala"><br>
    <input type="text" id="certificado" placeholder="Certificado"><br>
    <input type="text" id="proveedor" placeholder="Proveedor"><br>
    <input type="text" id="inspeccion" placeholder="Inspección"><br>
    <input type="text" id="observaciones" placeholder="Observaciones"><br>
    <label>Imágenes (máx 6):</label><br>
    <input type="file" id="imagenes" multiple accept="image/*"><br><br>
    <button type="submit">Guardar</button>
  </form>

  <script>
    document.getElementById("formulario").addEventListener("submit", async function(e){
      e.preventDefault();

      // Leer campos de texto
      const data = {
        marcaTemporal: new Date().toISOString(),
        nombre: document.getElementById("nombre").value,
        codigoSAP: document.getElementById("codigoSAP").value,
        reserva: document.getElementById("reserva").value,
        disciplina: document.getElementById("disciplina").value,
        descripcion: document.getElementById("descripcion").value,
        cantidad: document.getElementById("cantidad").value,
        diametro: document.getElementById("diametro").value,
        sch: document.getElementById("sch").value,
        longitud: document.getElementById("longitud").value,
        peso: document.getElementById("peso").value,
        fabricante: document.getElementById("fabricante").value,
        serial: document.getElementById("serial").value,
        modelo: document.getElementById("modelo").value,
        escala: document.getElementById("escala").value,
        certificado: document.getElementById("certificado").value,
        proveedor: document.getElementById("proveedor").value,
        inspeccion: document.getElementById("inspeccion").value,
        observaciones: document.getElementById("observaciones").value
      };

      // Leer imágenes y convertirlas en Base64
      const imagenFiles = document.getElementById("imagenes").files;
      const imagenesBase64 = [];

      for (let i = 0; i < imagenFiles.length && i < 6; i++) {
        const base64 = await fileToBase64(imagenFiles[i]);
        imagenesBase64.push(base64);
      }

      // Agregar las imágenes al data
      for (let i = 0; i < 6; i++) {
        data[`imagen${i+1}`] = imagenesBase64[i] || "";
      }

      // Enviar a SheetDB
      try {
        const response = await fetch("https://sheetdb.io/api/v1/8ma5fhqubdk9o", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(data)
        });

        if (response.ok) {
          alert("✅ Producto guardado en Google Sheets");
        } else {
          alert("❌ Error al guardar en Google Sheets: " + response.statusText);
        }
      } catch (error) {
        alert("❌ Error de red o conexión: " + error);
      }
    });

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = (error) => reject(error);
      });
    }
  </script>
</body>
</html>
