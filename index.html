// Guardar producto
document.getElementById('productForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  try {
    const imagenesInput = document.getElementById('imagenes');
    const imagenes = [];
    for (const file of imagenesInput.files) {
      const base64 = await toBase64(file);
      imagenes.push(base64);
    }

    const data = {
      timestamp: new Date().toISOString(),
      nombre: document.getElementById('nombre').value,
      codigoSAP: document.getElementById('codigoSAP').value,
      reserva: document.getElementById('reserva').value,
      disciplina: document.getElementById('disciplina').value,
      descripcion: document.getElementById('descripcion').value,
      cantidad: document.getElementById('cantidad').value,
      diametro: document.getElementById('diametro').value,
      sch: document.getElementById('sch').value,
      longitud: document.getElementById('longitud').value,
      peso: document.getElementById('peso').value,
      fabricante: document.getElementById('fabricante').value,
      serial: document.getElementById('serial').value,
      modelo: document.getElementById('modelo').value,
      escala: document.getElementById('escala').value,
      certificado: document.getElementById('certificado').value,
      proveedor: document.getElementById('proveedor').value,
      inspeccion: document.getElementById('inspeccion').value,
      observaciones: document.getElementById('observaciones').value,
      imagenes
    };

    const response = await fetch(webhookURL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const contentType = response.headers.get('content-type');
    if (contentType && contentType.includes('application/json')) {
      const res = await response.json();
      if (res.status === "success") {
        alert('✅ ' + res.message);
        document.getElementById('productForm').reset();
        loadHistorial();
      } else {
        alert('❌ Error del servidor: ' + res.message);
      }
    } else {
      const text = await response.text();
      alert('❌ Respuesta inesperada:\n' + text);
    }

  } catch (error) {
    alert('❌ Error de red o conexión:\n' + error);
    console.error(error);
  }
});
// Entrega de material
document.getElementById('entregaForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const data = {
    operacion: 'entrega',
    codigoSAP: document.getElementById('entregaCodigoSAP').value,
    cantidad: document.getElementById('entregaCantidad').value
  };

  try {
    const response = await fetch(webhookURL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const contentType = response.headers.get('content-type');
    if (contentType && contentType.includes('application/json')) {
      const res = await response.json();
      if (res.status === "success") {
        alert('✅ ' + res.message);
        document.getElementById('entregaForm').reset();
        loadHistorial();
      } else {
        alert('❌ Error del servidor: ' + res.message);
      }
    } else {
      const text = await response.text();
      alert('❌ Respuesta inesperada:\n' + text);
    }

  } catch (error) {
    alert('❌ Error de red o conexión:\n' + error);
    console.error(error);
  }
});
// Reintegro de material
document.getElementById('reintegroForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const data = {
    operacion: 'reintegro',
    codigoSAP: document.getElementById('reintegroCodigoSAP').value,
    cantidad: document.getElementById('reintegroCantidad').value
  };

  try {
    const response = await fetch(webhookURL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const contentType = response.headers.get('content-type');
    if (contentType && contentType.includes('application/json')) {
      const res = await response.json();
      if (res.status === "success") {
        alert('✅ ' + res.message);
        document.getElementById('reintegroForm').reset();
        loadHistorial();
      } else {
        alert('❌ Error del servidor: ' + res.message);
      }
    } else {
      const text = await response.text();
      alert('❌ Respuesta inesperada:\n' + text);
    }

  } catch (error) {
    alert('❌ Error de red o conexión:\n' + error);
    console.error(error);
  }
});
